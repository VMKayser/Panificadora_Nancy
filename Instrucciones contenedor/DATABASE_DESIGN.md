# üìä Dise√±o de Base de Datos - Panificadora Nancy

## üéØ Objetivo
Esta base de datos soporta un sistema completo de e-commerce con gesti√≥n de inventario, pedidos, pagos y roles de usuario.

---

## üìã Lista de Tablas (16 tablas)

### **M√≥dulo de Usuarios y Autenticaci√≥n**
1. `users` - Usuarios del sistema (clientes, vendedores, admins)
2. `roles` - Roles del sistema
3. `role_user` - Relaci√≥n usuarios-roles (tabla pivote)

### **M√≥dulo de Productos**
4. `categories` - Categor√≠as de productos
5. `products` - Productos disponibles
6. `product_images` - Im√°genes de productos

### **M√≥dulo de Inventario**
7. `inventory_products` - Stock de productos terminados
8. `inventory_materials` - Stock de materia prima (opcional para v2)

### **M√≥dulo de Capacidad de Producci√≥n**
9. `production_capacity` - L√≠mites de producci√≥n semanal
10. `production_bookings` - Reservas de cupos por pedido

### **M√≥dulo de Pedidos y Ventas**
11. `orders` - Pedidos/√≥rdenes de compra
12. `order_items` - Productos dentro de cada pedido
13. `shipping_addresses` - Direcciones de env√≠o de clientes

### **M√≥dulo de Pagos**
14. `payments` - Registro de pagos realizados
15. `payment_methods` - M√©todos de pago disponibles

### **M√≥dulo de Configuraci√≥n**
16. `settings` - Configuraciones globales del sistema

---

## üóÇÔ∏è Descripci√≥n Detallada de Tablas

### 1. **users** (Usuarios)
```sql
Almacena todos los usuarios del sistema: clientes, vendedores y administradores.

Campos:
- id (PK)
- name (VARCHAR) - Nombre completo
- email (VARCHAR UNIQUE) - Email para login
- password (VARCHAR) - Contrase√±a encriptada
- phone (VARCHAR NULLABLE) - Tel√©fono de contacto
- is_active (BOOLEAN) - Si la cuenta est√° activa
- email_verified_at (TIMESTAMP NULLABLE)
- created_at, updated_at

Relaciones:
- Tiene muchos: orders, shipping_addresses
- Pertenece a muchos: roles (tabla pivote role_user)
```

---

### 2. **roles** (Roles)
```sql
Define los 3 roles del sistema.

Campos:
- id (PK)
- name (VARCHAR UNIQUE) - 'admin', 'vendedor', 'cliente'
- description (TEXT NULLABLE)
- created_at, updated_at

Datos iniciales (Seeder):
1. admin - Administrador total
2. vendedor - Personal de tienda
3. cliente - Usuario comprador

Relaciones:
- Pertenece a muchos: users
```

---

### 3. **role_user** (Tabla Pivote)
```sql
Relaciona usuarios con sus roles (un usuario puede tener varios roles).

Campos:
- id (PK)
- user_id (FK ‚Üí users.id)
- role_id (FK ‚Üí roles.id)
- created_at, updated_at
```

---

### 4. **categories** (Categor√≠as)
```sql
Categor√≠as de productos (Panes, Empanadas, Temporada, etc.).

Campos:
- id (PK)
- name (VARCHAR) - Nombre de la categor√≠a
- slug (VARCHAR UNIQUE) - URL amigable (ej: 'panes')
- description (TEXT NULLABLE)
- image (VARCHAR NULLABLE) - Imagen de la categor√≠a
- is_active (BOOLEAN) - Si est√° visible
- order (INTEGER) - Orden de visualizaci√≥n
- created_at, updated_at

Relaciones:
- Tiene muchos: products
```

---

### 5. **products** (Productos)
```sql
Todos los productos de la panader√≠a.

Campos:
- id (PK)
- category_id (FK ‚Üí categories.id)
- name (VARCHAR) - Nombre del producto
- slug (VARCHAR UNIQUE) - URL amigable
- description (TEXT) - Descripci√≥n completa
- short_description (VARCHAR NULLABLE) - Descripci√≥n corta para cards
- price_retail (DECIMAL 8,2) - Precio minorista en Bs.
- price_wholesale (DECIMAL 8,2 NULLABLE) - Precio mayorista en Bs.
- min_wholesale_qty (INTEGER NULLABLE) - Cantidad m√≠nima para precio mayorista
- is_seasonal (BOOLEAN) - Si es producto de temporada
- is_active (BOOLEAN) - Si est√° disponible para venta
- requires_advance_order (BOOLEAN) - Si requiere pedido anticipado
- advance_hours (INTEGER NULLABLE) - Horas de anticipaci√≥n requeridas
- has_capacity_limit (BOOLEAN) - Si tiene l√≠mite de producci√≥n semanal
- created_at, updated_at

Relaciones:
- Pertenece a: category
- Tiene muchos: product_images, inventory_products, order_items, production_capacity
```

---

### 6. **product_images** (Im√°genes de Productos)
```sql
M√∫ltiples im√°genes por producto.

Campos:
- id (PK)
- product_id (FK ‚Üí products.id)
- image_url (VARCHAR) - Ruta de la imagen
- is_primary (BOOLEAN) - Si es la imagen principal
- order (INTEGER) - Orden de visualizaci√≥n
- created_at, updated_at

Relaciones:
- Pertenece a: product
```

---

### 7. **inventory_products** (Inventario de Productos)
```sql
Control de stock de productos terminados.

Campos:
- id (PK)
- product_id (FK ‚Üí products.id UNIQUE)
- quantity (INTEGER) - Cantidad disponible
- min_stock (INTEGER) - Stock m√≠nimo (para alertas)
- last_restock_date (TIMESTAMP NULLABLE)
- created_at, updated_at

Relaciones:
- Pertenece a: product
```

---

### 8. **inventory_materials** (Inventario de Materia Prima)
```sql
Control de insumos (OPCIONAL - puede implementarse en v2).

Campos:
- id (PK)
- name (VARCHAR) - Nombre del insumo (ej: "Harina")
- unit (VARCHAR) - Unidad de medida (kg, L, unidades)
- quantity (DECIMAL 10,2) - Cantidad disponible
- min_stock (DECIMAL 10,2) - Stock m√≠nimo
- cost_per_unit (DECIMAL 8,2) - Costo por unidad
- created_at, updated_at
```

---

### 9. **production_capacity** (Capacidad de Producci√≥n)
```sql
Define l√≠mites de producci√≥n semanal para productos espec√≠ficos.

Campos:
- id (PK)
- product_id (FK ‚Üí products.id)
- max_per_week (INTEGER) - M√°ximo de unidades producibles por semana
- current_week_bookings (INTEGER) - Cupos reservados esta semana
- week_start_date (DATE) - Inicio de la semana actual
- created_at, updated_at

Relaciones:
- Pertenece a: product
- Tiene muchos: production_bookings

L√≥gica:
- Se resetea autom√°ticamente cada lunes
- No permite pedidos si current_week_bookings >= max_per_week
```

---

### 10. **production_bookings** (Reservas de Cupos)
```sql
Registra qu√© pedidos reservaron cupos de producci√≥n.

Campos:
- id (PK)
- production_capacity_id (FK ‚Üí production_capacity.id)
- order_id (FK ‚Üí orders.id)
- quantity_reserved (INTEGER) - Cu√°ntas unidades reserv√≥
- week_date (DATE) - Semana para la cual reserv√≥
- created_at, updated_at

Relaciones:
- Pertenece a: production_capacity, order
```

---

### 11. **orders** (Pedidos)
```sql
Todos los pedidos del sistema (online y tienda f√≠sica).

Campos:
- id (PK)
- user_id (FK ‚Üí users.id NULLABLE) - NULL si es venta sin registro
- order_number (VARCHAR UNIQUE) - N√∫mero de pedido (ej: "PAN-2025-0001")
- status (ENUM) - 'pendiente', 'confirmado', 'en_preparacion', 'listo', 'enviado', 'entregado', 'cancelado'
- subtotal (DECIMAL 10,2) - Suma de productos
- discount (DECIMAL 10,2 DEFAULT 0) - Descuentos aplicados
- shipping_cost (DECIMAL 8,2 DEFAULT 0) - Costo de env√≠o (si aplica)
- total (DECIMAL 10,2) - Total final
- payment_status (ENUM) - 'pendiente', 'pagado', 'fallido', 'reembolsado'
- delivery_method (ENUM) - 'pickup' (recojo), 'delivery' (env√≠o)
- delivery_date (DATE NULLABLE) - Fecha estimada de entrega/recojo
- shipping_address_id (FK ‚Üí shipping_addresses.id NULLABLE)
- notes (TEXT NULLABLE) - Notas del cliente o vendedor
- source (ENUM) - 'online', 'pos' (punto de venta)
- requires_invoice (BOOLEAN DEFAULT FALSE) - Si solicita factura
- created_at, updated_at

Relaciones:
- Pertenece a: user, shipping_address
- Tiene muchos: order_items, payments, production_bookings
```

---

### 12. **order_items** (√çtems del Pedido)
```sql
Productos individuales dentro de cada pedido.

Campos:
- id (PK)
- order_id (FK ‚Üí orders.id)
- product_id (FK ‚Üí products.id)
- product_name (VARCHAR) - Guardamos nombre por si se edita el producto despu√©s
- quantity (INTEGER) - Cantidad comprada
- unit_price (DECIMAL 8,2) - Precio unitario al momento de la compra
- subtotal (DECIMAL 10,2) - quantity * unit_price
- created_at, updated_at

Relaciones:
- Pertenece a: order, product
```

---

### 13. **shipping_addresses** (Direcciones de Env√≠o)
```sql
Direcciones guardadas de los clientes.

Campos:
- id (PK)
- user_id (FK ‚Üí users.id)
- full_name (VARCHAR) - Nombre completo del receptor
- phone (VARCHAR) - Tel√©fono de contacto
- department (VARCHAR) - Departamento (La Paz, Cochabamba, etc.)
- city (VARCHAR) - Ciudad
- address_line (TEXT) - Direcci√≥n completa
- reference (TEXT NULLABLE) - Referencias adicionales
- is_default (BOOLEAN) - Si es la direcci√≥n predeterminada
- created_at, updated_at

Relaciones:
- Pertenece a: user
- Tiene muchos: orders
```

---

### 14. **payments** (Pagos)
```sql
Registro de todos los pagos recibidos.

Campos:
- id (PK)
- order_id (FK ‚Üí orders.id)
- payment_method_id (FK ‚Üí payment_methods.id)
- transaction_id (VARCHAR NULLABLE) - ID de la transacci√≥n externa (QR, tarjeta)
- amount (DECIMAL 10,2) - Monto pagado
- status (ENUM) - 'pending', 'completed', 'failed', 'refunded'
- payment_date (TIMESTAMP NULLABLE) - Cu√°ndo se complet√≥ el pago
- qr_image_url (VARCHAR NULLABLE) - URL del QR generado (si aplica)
- metadata (JSON NULLABLE) - Datos adicionales de la pasarela
- created_at, updated_at

Relaciones:
- Pertenece a: order, payment_method
```

---

### 15. **payment_methods** (M√©todos de Pago)
```sql
M√©todos de pago disponibles.

Campos:
- id (PK)
- name (VARCHAR) - Nombre del m√©todo (ej: "QR Simple BNB")
- code (VARCHAR UNIQUE) - C√≥digo interno ('qr_simple', 'tarjeta', 'efectivo')
- is_active (BOOLEAN) - Si est√° habilitado
- requires_validation (BOOLEAN) - Si requiere validaci√≥n autom√°tica
- created_at, updated_at

Datos iniciales:
1. QR Simple (BNB)
2. Tarjeta Cr√©dito/D√©bito
3. Efectivo (para POS)
4. Transferencia Bancaria

Relaciones:
- Tiene muchos: payments
```

---

### 16. **settings** (Configuraciones)
```sql
Configuraciones globales del sistema (clave-valor).

Campos:
- id (PK)
- key (VARCHAR UNIQUE) - Nombre de la configuraci√≥n
- value (TEXT) - Valor (puede ser JSON)
- type (ENUM) - 'boolean', 'string', 'number', 'json'
- description (TEXT NULLABLE)
- created_at, updated_at

Ejemplos de configuraciones:
- invoice_enabled (boolean) - Si se solicitan facturas
- shipping_national_enabled (boolean) - Si est√° habilitado env√≠o nacional
- min_order_amount (number) - Monto m√≠nimo de pedido
- business_phone (string) - Tel√©fono de contacto
- business_email (string) - Email de contacto
```

---

## üîó Diagrama de Relaciones (Resumen)

```
users (1) ‚îÄ‚îÄ‚Üí (N) orders
users (N) ‚îÄ‚îÄ‚Üí (N) roles [role_user]
users (1) ‚îÄ‚îÄ‚Üí (N) shipping_addresses

categories (1) ‚îÄ‚îÄ‚Üí (N) products

products (1) ‚îÄ‚îÄ‚Üí (N) product_images
products (1) ‚îÄ‚îÄ‚Üí (1) inventory_products
products (1) ‚îÄ‚îÄ‚Üí (1) production_capacity
products (1) ‚îÄ‚îÄ‚Üí (N) order_items

orders (1) ‚îÄ‚îÄ‚Üí (N) order_items
orders (1) ‚îÄ‚îÄ‚Üí (N) payments
orders (1) ‚îÄ‚îÄ‚Üí (N) production_bookings
orders (N) ‚îÄ‚îÄ‚Üí (1) shipping_addresses

production_capacity (1) ‚îÄ‚îÄ‚Üí (N) production_bookings

payment_methods (1) ‚îÄ‚îÄ‚Üí (N) payments
```

---

## üìö Pr√≥ximos Pasos

1. ‚úÖ **Revisar y entender** cada tabla
2. üìù **Crear migraciones en Laravel** (siguiente paso)
3. üèóÔ∏è **Crear modelos** con sus relaciones
4. üå± **Crear seeders** con datos de prueba
5. üîå **Crear API** para consumir estos datos

---

## üí° Conceptos que Aprender√°s

- **Primary Key (PK)**: ID √∫nico de cada registro
- **Foreign Key (FK)**: Referencia a otra tabla
- **UNIQUE**: Valor que no se puede repetir
- **NULLABLE**: Campo opcional
- **ENUM**: Campo con valores predefinidos
- **Relaciones**:
  - 1:N (Uno a Muchos): Una categor√≠a tiene muchos productos
  - N:N (Muchos a Muchos): Usuarios y roles (con tabla pivote)
  - 1:1 (Uno a Uno): Producto y su inventario

---

## üéØ ¬øDudas sobre alguna tabla?

Puedes preguntarme:
- ¬øPor qu√© se necesita esta tabla?
- ¬øC√≥mo se relaciona con las dem√°s?
- ¬øQu√© significa cada campo?

**¬°Est√°s listo para el siguiente paso: Crear esto en Laravel!** üöÄ
